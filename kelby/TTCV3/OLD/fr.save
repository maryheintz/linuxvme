#include <stdio.h>#include <math.h>#include "vmebase.h"int id,ttcadr;char string[80];char adcno[7];main(){    FILE *fp;   char name[7];   int tube,i,k,board,pass,errors,ierr;   unsigned int i1,i2,itst;   unsigned short shrt;   int trig,s1,s2,s3,s4,itr,ire,mse,tplo,tphi;   unsigned long status;   int good,bad,total,kkk;   status = vme_a24_base();   printf("enter ttc address\n");   fscanf(stdin,"%x",&ttcadr);     fp=fopen("/home/kelby/TTCV3/adc.num","r");   fscanf(fp,"%s",adcno);   printf("%x  %s\n",ttcadr,adcno);   pass=0;   errors=0;strt0:   board = 1;   id = (board<<6) | 1;    ttcvi_mapr(ttcadr);   reset_ctrl_can();   printf("calling can_reset - this takes a few seconds\n");   can_reset(ttcadr);   can_init(board,adcno);strt1:   good=0;   bad=0;   ierr=0;   for(k=1;k<49;k++)      {          kkk=cardchk(k);        if(kkk == 1)	  { good++;            printf(" card %d found  %x\n",k,k);	  } 	if(kkk != 1)	  { bad++;             printf("no card %d  %x\n",k,k);	  }     }   pass++;   total=good+bad;   if(good != 48) ierr=1;   kkk = cardchk(0);   if(kkk == 1) ierr=1;   if(kkk == 1) printf("error card 0 found\n");   kkk = cardchk(49);   if(kkk == 1) printf("error card 49 found\n");   if(kkk == 1) ierr=1;   if(ierr != 0) errors++;   if(sw(4)==0) printf("pass=%d   good=%d    bad=%d     %d   errors=%d\n",         pass,good,bad,total,errors);   if(sw(1) != 1)      { printf(" \n");       usleep(50);       if(sw(3) == 1) goto strt1;        goto strt0;     }      }cardchk(k)int k;  {int i,status;   unsigned short shrt;   int trig,s1,s2,s3,s4,itr,ire,mse,tplo,tphi,ok;   ok=0;   status=0;   multi_low(ttcadr);   back_low(ttcadr);   set_tube(ttcadr,k);   set_intg_gain(ttcadr,5);   /* s1=s3=1 s2=s4=0 */   itr_high(ttcadr);           /* itr=1 */   intg_rd_low(ttcadr);        /* ire=0 */   mse_high(ttcadr);           /* mse=1 */   small_cap_disable(ttcadr);  /* tplo=0 */   large_cap_enable(ttcadr);   /* tphi=1 */   trig_disable(ttcadr);       /* trig=0 */   back_high(ttcadr);   back_low(ttcadr);   status=can_3in1set(id,0xd400);   /* fetch from 3in1 */   status=can_3in1get(id,&shrt);    /* and load can output reg */   i = (int)shrt;   trig = i & 1;   s1 = (i>>1) & 1;   s2 = (i>>2) & 1;   s3 = (i>>3) & 1;   s4 = (i>>4) & 1;   itr = (i>>5) & 1;   ire = (i>>6) & 1;   mse = (i>>7) & 1;   tplo = (i>>8) & 1;   tphi = (i>>9) & 1;   if((s1==1) && (s2==0)  && (s3==1) && (s4==0) && (itr==1) &&      (ire==0) && (mse==1) && (tplo==0) && (tphi==1) &&       (trig==0) ) ok++;   if(sw(2)==1)       { printf("\nexpect s= 1 0 1 0 itr=1 ire=0 mse=1 tplo=0 tphi=1 trig=0\n");         printf("k=%d s1..4=%d %d %d %d itr=%d ire=%d mse=%d tplo=%d tphi=%d trig=%d %x\n"           ,k,s1,s2,s3,s4,itr,ire,mse,tplo,tphi,trig,i);      }   set_intg_gain(ttcadr,0xa);   /* s1=s3=0 s2=s4=1 */   itr_low(ttcadr);           /* itr=0 */   intg_rd_high(ttcadr);        /* ire=1 */   mse_low(ttcadr);           /* mse=0 */   small_cap_enable(ttcadr);  /* tplo=1 */   large_cap_disable(ttcadr);   /* tphi=0 */   trig_enable(ttcadr);       /* trig=1 */   back_high(ttcadr);   back_low(ttcadr);   status=can_3in1set(id,0xd400);   /* fetch from 3in1 */   status=can_3in1get(id,&shrt);    /* and load can output reg */   i = (int)shrt;   trig = i & 1;   s1 = (i>>1) & 1;   s2 = (i>>2) & 1;   s3 = (i>>3) & 1;   s4 = (i>>4) & 1;   itr = (i>>5) & 1;   ire = (i>>6) & 1;   mse = (i>>7) & 1;   tplo = (i>>8) & 1;   tphi = (i>>9) & 1;   if((s1==0) && (s2==1)  && (s3==0) && (s4==1) && (itr==0) &&      (ire==1) && (mse==0) && (tplo==1) && (tphi==0) &&       (trig==1) ) ok++;   if(sw(2)==1)       { printf("expect s= 0 1 0 1 itr=0 ire=1 mse=0 tplo=1 tphi=0 trig=1\n");         printf("k=%d s1..4=%d %d %d %d itr=%d ire=%d mse=%d tplo=%d tphi=%d trig=%d %x\n"           ,k,s1,s2,s3,s4,itr,ire,mse,tplo,tphi,trig,i);      }  if(ok == 2) status=1;   return(status);  }