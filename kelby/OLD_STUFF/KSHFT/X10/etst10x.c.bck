#include <stdio.h>
#include <math.h>
double area[175]=
  {   274.450000,59342.150000,149653.000000,175683.650000,188821.650000,
   198516.150000,206472.250000,213097.000000,218608.900000,223203.650000,
   227011.250000,230187.500000,232841.450000,235041.150000,236859.400000,
   238364.250000,239657.600000,240801.300000,241820.050000,242720.900000,
   243525.050000,244247.700000,244906.450000,245487.050000,246011.650000,
   246483.200000,246913.450000,247300.350000,247651.450000,247965.750000,
   248250.100000,248501.250000,248731.450000,248942.250000,249132.200000,
   249304.550000,249452.300000,249593.950000,249719.050000,249826.250000,
   249926.200000,250014.100000,250095.650000,250168.150000,250238.000000,
   250297.900000,250350.650000,250398.000000,250444.200000,250486.150000,
   250523.150000,250554.900000,250583.700000,250611.850000,250636.900000,
   250657.500000,250677.500000,250694.450000,250709.850000,250724.350000,
   250737.450000,250749.350000,250761.500000,250769.850000,250778.600000,
   250786.400000,250792.900000,250799.950000,250806.550000,250812.700000,
   250817.700000,250822.550000,250826.750000,250830.250000,250832.750000,
   250835.950000,250838.800000,250840.900000,250842.750000,250844.800000,
   250846.200000,250847.600000,250849.400000,250850.200000,250851.000000,
   250851.950000,250852.900000,250853.550000,250854.300000,250854.700000,
   250855.500000,250856.000000,250856.650000,250857.100000,250857.300000,
   250857.550000,250858.100000,250858.450000,250858.600000,250858.950000,
   250859.250000,250859.450000,250859.550000,250859.700000,250859.750000,
   250859.800000,250859.900000,250860.000000,250860.100000,250860.200000,
   250860.250000,250860.300000,250860.300000,250860.450000,250860.500000,
   250860.550000,250860.600000,250860.650000,250860.700000,250860.750000,
   250860.800000,250860.900000,250860.900000,250860.900000,250860.950000,
   250860.950000,250861.000000,250861.000000,250861.000000,250861.000000,
   250861.000000,250861.050000,250861.050000,250861.050000,250861.050000,
   250861.050000,250861.050000,250861.050000,250861.050000,250861.050000,
   250861.050000,250861.050000,250861.050000,250861.050000,250861.050000,
   250861.050000,250861.050000,250861.050000,250861.050000,250861.050000,
   250861.050000,250861.050000,250861.050000,250861.050000,250861.050000,
   250861.050000,250861.050000,250861.050000,250861.050000,250861.050000,
   250861.050000,250861.050000,250861.050000,250861.050000,250861.050000,
   250861.050000,250861.050000,250861.050000,250861.050000,250861.050000,
   250861.050000,250861.050000,250861.050000,250861.100000,250861.100000};
double xbin[175];
unsigned int sw_base,vme_base;
double a1,b1,a2,b2,a3,b3;
main()
{ int i,l,k,ibin;
  FILE *fp;
  double E,xbin,ybin;
  unsigned long init[4]={0x123, 0x234, 0x345, 0x456}, length=4;
  init_by_array(init, length); 
  vme_base = vme_a24_base();
  sw_base = vme_base + 0xaa0000;
  hstset(0,2.5,0.0,200,-7);  
  hstset(1,10.0,0.0,200,-7);  
loop:
     pick(&E);
     hstacc(0,E,1.0);
     hstacc(1,E,1.0);
  if(sw(7)==1) 
   { sidev(1);
     hstwrt(0);
     hstwrt(1);
     sidev(2);
     hstwrt(0);
     hstwrt(1);
   }
  goto loop; 
}
sw(i)
int i;
{ int k,l,shift;
  unsigned short *adr;
  (unsigned short *)adr = (unsigned short *)(sw_base + 0x0c);
  k = *adr;
  shift = i-1;
  l = (k>>shift) & 1;
  return(l);
}
pick(double *E)
{ int i,k;
  static int ent=0;
  double r,adx,da;
  FILE *fp;
  double sum;
  sum=0.0;
  if(ent==0)
   { for(i=0;i<175;i++) xbin[i]=0.025 + (double)i * 0.05;
     ent=1;
   }
   rmt(&r);
   a = 250861.1*r;
   k=0;
   for(i=0;i<175;i++)
    { if(area[i]<a) continue;
      dx=xbin[i]-xbin[i-1];
      da=area[i]-area[i-1];
      *E=xbin[i-1]+(a-area[i-1])*dx/da;
      return(0);
    }
 }
    double hstfit(i,l,x)
    int i,l;
    double x;
    {double y;
     y=90.0*exp(-0.1*x);
     return(y); 
    }  
       
