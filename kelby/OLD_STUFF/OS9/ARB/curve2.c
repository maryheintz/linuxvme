#define LF '\x0a'#define BELL '\x07'#include <stdio.h>#include <math.h>#include <time.h>#include <strings.h>unsigned char string[8000],back[8000];main()  { FILE *fp;    int i,ii,iy,ipnt,i1,i2;    double x,y,dx;    unsigned char gpib_device=13;    fp=fopen("wave.dat","w");    gpib_reset();/*    sprintf(string,":DEBUG:SNOOP:STATE ON;DELAY:TIME 1.0 \0");     printf(":DEBUG:SNOOP:STATE ON\n");    sendmessage(gpib_device, string );  */    sprintf(string,":DEBUG:SNOOP:STATE OFF \0");     printf(":DEBUG:SNOOP:STATE OFF\n");    sendmessage(gpib_device, string );    sprintf(string,"DATA:DESTINATION 'ABC.WFM' \0");     printf("DATA:DESTINATION 'TEST.WFM'\n");    sendmessage(gpib_device, string );     sprintf(string,"DATA:WIDTH2:ENCDG SRPBINARY\0");    printf("DATA:WIDTH2:ENCDG SRPBINARY\n");    fflush(stdout);    sendmessage(gpib_device, string );     sprintf(string,"WFMPRE:YZERO 0.0 \0");    printf("WFMPRE:YZERO 0.0\n");    sendmessage(gpib_device, string );     sprintf(string,"WFMPRE:YMULT 1.0e-03 \0");    printf("WFMPRE:YMULT 1.0e-03\n");    sendmessage(gpib_device, string );     sprintf(string,"WFMPRE:XINCR 9.7646e-10 \0");    printf("WFMPRE:XINCR 9.7646e-10\n");    sendmessage(gpib_device, string );     sprintf(string,":CURVE #41024");    ipnt=13;    dx=(2.0*3.1415927)/511.0;    for(i=0;i<512;i++)     {x=dx*(double)i;      y=4096.0*sin(x);      if(y<0.0) y=0.0;      iy=(int)y;      i1=iy&0xff;      i2=(iy>>8)&0xff;      string[ipnt++]=(unsigned char)i2;      string[ipnt++]=(unsigned char)i1;     }    sendsize(gpib_device, string,ipnt );    printf("CURVE #41024<bytes of data>\n");    sprintf(string,"CH1:WAVEFORM 'ABC.WFM' \0");     printf("CH1:WAV 'ABC.WFM' \n");     sendmessage(gpib_device, string );     sprintf(string,"CH1:OFFSET 1.0V \0");     printf("CH1:OFFSET 1.0V \n");     sendmessage(gpib_device, string );     sprintf(string,"CH1:AMPL 2.0V \0");     printf("CH1:AMPL 2.0V \n");     sendmessage(gpib_device, string );     sprintf(string,":MODE CONT \0");     printf("MODE CONT \n");     sendmessage(gpib_device, string );     sprintf(string,"OUTPUT:CH1:NORMAL:STATE 1 \0");     printf("OUTPUT:CH1:NORMAL:STATE 1 \n");     sendmessage(gpib_device, string ); /*    sleep(1);    for(i=0;i<ipnt;i++)       {ii=(int)string[i];       fprintf(fp,"i=%d string=%x",i,ii);       if(ii>31 && ii,127) fprintf(fp," %c",string[i]);       fprintf(fp,"\n");} *//*    sprintf(string,":CURVE?");     sendmessage(gpib_device, string );     getmessage(gpib_device, back );    i=0;    while(back[i] != '\0')      {printf("i=%d",i);      ii=(int)back[i];      printf(" back[i]=%x",ii);      if(ii>31 && ii<127) printf(" %c",back[i]);      printf("\n");      i++;} */      return(0);     }fgetline(fp,s)  FILE *fp;  char s[];  {int c,i,lim;   lim=80;   i=0;   while(--lim>0&&(c=getc(fp)) != EOF && c != '\n')    s[i++] =c;   s[i]='\0';   if(i<1)     i=EOF;   return(i);  }