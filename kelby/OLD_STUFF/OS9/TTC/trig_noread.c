#include <stdio.h>#include <math.h>int fdata[40],pk,ipk;int swtst;unsigned short *reg0,*reg2,*reg4,*reg6,*reg8,*rega;unsigned long *swtch, *adr;unsigned int base;main(){  int ipass=0,restart;   int zone,sector,tube,mode,i,phase,dac,k,ena[5];   double asum,axsum,axxsum,ped,dped,sig2,aval,signal;    char string[80];    double fdac,charge,capacitor;   ttcvi_map();/*   printf(" enter zone sector tube\n");   fscanf(stdin,"%d %d %d",&zone,&sector,&tube);  */   zone = 0;   sector = 0;   set_zone(zone);   set_sector(sector);   set_mb_time(1,0);   set_mb_time(2,0);   set_mb_time(3,0);   set_mb_time(4,0);   capacitor = 100.0;    charge=700.0;   printf(" enter charge\n");   fscanf(stdin,"%lf",&charge);    fdac = (1023.0*charge) / (2.0 * 4.096 * capacitor);    dac = (int)fdac;    charge = 2.0 * 4.096 * capacitor * (double)dac / 1023.0;    printf("logain charge=%f dac=%d capacitor=%f\n",         charge,dac,capacitor);    printf("enable enable pattern eg 0 1 0 0 0 for 44 only\n");    fscanf(stdin,"%d %d %d %d %d",&ena[0],&ena[1],&ena[2],&ena[3],&ena[4]);    printf("ena = %d %d %d %d %d\n",ena[0],ena[1],ena[2],ena[3],ena[4]);   for(k=43;k<48;k++)    { tube = k;      set_tube(tube);      large_cap_enable();      tsleep(0x80000010);      small_cap_disable();      tsleep(0x80000010);      trig_disable();      if(ena[k-43] == 1) trig_enable();      set_dac(dac);      tsleep(0x80000010);    }        tp_low();   printf(" enter clock phase 0-239\n");   fscanf(stdin,"%d",&phase);/*   phase = 116;  */   SetTimeDes2(0,phase);  loop:   inject();}     inject()       { static int entry=0;         int c1,c2,f1,f2,swtst,i,i1,i2,i0time,i3time;         if(entry == 0)	   {/* setup inhibit1 to set tp high */	     SetBMode(1,0xc);	     SetInhibitDelay(1,10);	     SetInhibitDuration(1,10);	     BPutLong(1,0,1,0x80,0x00);  /* load set tp_high into fifo1 */	     /* set inhibit2 to drop tp low (timed broadcast mode */	     SetBMode(2,0xc);	     SetInhibitDelay(2,2000);	     SetInhibitDuration(2,10);	    /* BPutLong(2,0,1,0x80,0x01);  */ /* load set tp_low into fifo2 */	     BPutShort(2,0xc0);   /* set tp low bcast command  */	     /* set inhibit3 to set latch                     */	     /* use latch-bar and inhibit3 to start fermi     */             /* will use inhibit 3 to set l1a with digitizers */             i3time=2025;/*	     printf("input i3time\n");             fscanf(stdin,"%d",&i3time);     */	     SetInhibitDelay(3,i3time);	     SetInhibitDuration(3,10);	     SetInhibitDelay(0,1);	     SetInhibitDuration(3,10);	    }  }