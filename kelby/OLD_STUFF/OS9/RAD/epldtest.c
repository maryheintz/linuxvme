#include <stdio.h>#include <math.h>int sw1,sw2,sw3,sw4,sw5,sw6,sw7,sw8;unsigned int delay;int year,month,day,hour,min,sec;int lyear,lmonth,lday,lhour,lmin,lsec;int l0year,l0month,l0day,l0hour,l0min,l0sec;struct {char year;        char month;        char day;        char hour;        char minute;        char second} tims;double source,rad;main(argc,argv,envs)int argc;char *argv[];char *envs[];  { int dmin,tmin,ierr,wait,timestep=1,ipass;    double tday;    int zone,sector,card,i,l;    unsigned short cadr,tval,sval,dval;    source = 18.9;/* --------------------- test loop --------------------------- */   zone = 1;   sector = 1;   card = 1;   l = (zone<<12) | (sector<<6) | card;   cadr = (unsigned short)l;   card_sel(cadr);   multi_low();   tval = (unsigned short)100;   tim1_set(tval);   tval = (unsigned short)50;   tim2_set(tval);   rtime();   for(i=0;i<=0x1fff;i++)        { sval = (unsigned short)i;          wrt_shift(13,sval);          read_shift(&dval);          if(sval != (dval&0x1fff) ) printf(" error sval=%x  dval=%x\n",                  (int)sval,(int)dval);         }    printf(" start test ok\n");/* -------------------- end test loop --------------------------- */    printf(" raise source and enter 1\n");    fscanf(stdin,"%d",&wait);    printf(" wait return - now taking data\n");    newtime();    l0year = year;    l0month = month;    l0day = day;    l0hour = hour;    l0min = min;    l0sec = sec;    ipass=0;next:   zone = 1;   sector = 1;   card = 1;   l = (zone<<12) | (sector<<6) | card;   cadr = (unsigned short)l;   card_sel(cadr);   multi_low();   tval = (unsigned short)100;   tim1_set(tval);   tval = (unsigned short)50;   tim2_set(tval);   rtime();   for(i=0;i<=0x1fff;i++)        { sval = (unsigned short)i;          wrt_shift(13,sval);          read_shift(&dval);          if(sval != (dval&0x1fff) ) goto error;         }    ipass++;    if(ipass>10)      { newtime();       tmin = ttinterval();       rad = source * tmin / 60.0;           printf("OK rad =% f\n",rad);       ipass=0;     }    goto next;error:    newtime();    tmin = ttinterval();    rad = source * tmin / 60.0;        printf("failure at rad=%f\n",rad);  }  /* end of main */sw(i)   /* new switch timer module */int i;{ int k,l,shift;  unsigned short *adr;  adr = (unsigned short *)( 0xf0aa000c);  k = *adr;  shift = i-1;  l = (k>>shift) & 1;  return(l);}newtime() {  getime(&tims.year);    year = (int)tims.year;    month = (int)tims.month;    day = (int)tims.day;    hour = (int)tims.hour;    min = (int)tims.minute;    sec = (int)tims.second; }ttinterval() { static int daym[13] = {0,31,28,31,30,31,30,31,31,30,31,30,31};   int sday,dday,dhour,dmin,interval;   if(month == l0month) dday = day - l0day;   if(month != l0month)      { sday = day + daym[l0month];       dday = sday - l0day;     }   dhour = hour - l0hour;   dmin = min - l0min;   interval = dday * 1440 + dhour * 60 + dmin;/*   printf("now  %d/%d/%d %d:%d:%d\n",year,month,day,hour,min,sec);     printf("total %d/%d/%d %d:%d:%d\n",lyear,lmonth,lday,lhour,lmin,lsec);     printf("dday=%d  dhour=%d  dmin=%d\n",dday,dhour,dmin);    printf("interval = %d\n",interval);  */   return(interval); }tinterval() { static int daym[13] = {0,31,28,31,30,31,30,31,31,30,31,30,31};   int sday,dday,dhour,dmin,interval;   if(month == lmonth) dday = day - lday;   if(month != lmonth)      { sday = day + daym[lmonth];       dday = sday - lday;     }   dhour = hour - lhour;   dmin = min - lmin;   interval = dday * 1440 + dhour * 60 + dmin;/*   printf("now  %d/%d/%d %d:%d:%d\n",year,month,day,hour,min,sec);     printf("last %d/%d/%d %d:%d:%d\n",lyear,lmonth,lday,lhour,lmin,lsec);     printf("dday=%d  dhour=%d  dmin=%d\n",dday,dhour,dmin);  */   return(interval); }