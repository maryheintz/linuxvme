#include <stdio.h>#include <math.h>static struct {int month;               int day;               int hour;               int min;               int nev[6];               double ped[6];               int dc[6][20];               double volts[6][20];               double v00[6];               double v10[6];               double v01[6];               double rad;} intgs;char xstring[80],ystring[80],string[80],err[80];int year,month,day,hour,min,sec;int lyear,lmonth,lday,lhour,lmin,lsec;main()  { FILE *fp_int;    int ntotal=0,n,i,nwds,ierr,max[6],del[6],gain,dacmax,isw[6],cardno;    int nn[6];    double dac;    double dmin,rad;    printf("input - card number\n");    fscanf(stdin,"%d",&cardno);    sprintf(string,"/z5/int%d.dat",cardno);    fp_int = fopen(string,"r");    nn[0]=6;    nn[1]=6;    nn[2]=11;    nn[3]=6;    nn[4]=9;    nn[5]=6;    max[0]=640;    max[1]=240;    max[2]=160;    max[3]=120;    max[4]=80;    max[5]=48;    del[0]=40;    del[1]=20;    del[2]=8;    del[3]=8;    del[4]=4;    del[5]=4;    isw[0]=1;    isw[1]=2;    isw[2]=0;    isw[3]=4;    isw[4]=8;    isw[5]=0xc;    dotzro();    for(gain=0;gain<6;gain++)      { dacmax = max[gain];        dotset(gain,10.0,0.0,12.0,0.0,0,0);        sprintf(xstring,"Krad isw=%x",isw[gain]);        sprintf(ystring,"volts");        dotlbl(gain,xstring,ystring);       }next:    nwds = fread(&intgs.month,4,432,fp_int);    ierr = feof(fp_int);    if(ierr != 0) goto done;    ntotal++;    printf(" ntotal=%d\n",ntotal);    year = 1998;    month = intgs.month;    day = intgs.day;    hour = intgs.hour;    min = intgs.min;    sec = 0;       if(ntotal == 1)     {lyear = 1998;      lmonth = month;      lday = day;      lhour = hour;      lmin = min;      lsec = 0;     }    dmin = tinterval();/*    rad = 19.08 * dmin / 60.0;    if(rad<0.3) rad=0.3;  */      rad = intgs.rad;/*    printf(" event=%d  nwds=%d  %d/%d  %d:%d\n",ntotal,nwds,       intgs.month,intgs.day,intgs.hour,intgs.min);  */    for(gain=0;gain<6;gain++)      { n = intgs.nev[gain];/*        printf("gain=%d  n=%d  nn=%d\n",gain,n,nn[gain]); */        for(i=0;i<=n;i++)                 { if(i == nn[gain])               { dotacc(gain,rad,intgs.volts[gain][i]);/*                printf("gain=%d  rad=%f  volt=%f  dac=%d\n",                  gain,rad,intgs.volts[gain][i],intgs.dc[gain][i]);  */              }          }      }   goto next;done:    dotmwr(6,0,5);    printf("done\n");  }tinterval() { static int daym[13] = {0,31,28,31,30,31,30,31,31,30,31,30,31};   int sday,dday,dhour,dmin,interval;   if(month == lmonth) dday = day - lday;   if(month != lmonth)      { sday = day + daym[lmonth];       dday = sday - lday;     }   dhour = hour - lhour;   dmin = min - lmin;   interval = dday * 1440 + dhour * 60 + dmin;/*   printf("now  %d/%d/%d %d:%d:%d\n",year,month,day,hour,min,sec);     printf("last %d/%d/%d %d:%d:%d\n",lyear,lmonth,lday,lhour,lmin,lsec);     printf("dday=%d  dhour=%d  dmin=%d\n",dday,dhour,dmin);  */   return(interval); }