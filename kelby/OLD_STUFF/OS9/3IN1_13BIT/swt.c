#include <stdio.h>#include <math.h>char string[1000];unsigned char gpib_adr = 3;int ent=0;main(){    int isw[6],i1,i2,ll,i,mode,s1,s2,s3,s4,itr,ire,mse,tpS,tpL,trg,sw1,dacset;   int card,zone,sector,tube,l;   unsigned short cadr,sval,dval,tval,t1val,t2val;   double fmin,ratio,volt[6],ped[6],expr[6];   zone=1;   sector=1;   card=38;   l = (zone<<12) | (sector<<6) | card;   cadr = (unsigned short)l;   card_sel(cadr);   multi_low();   tval = (unsigned short)100;   tim1_set(tval);   tval = (unsigned short)50;   tim2_set(tval);   rtime();   printf(" select desired test - loop\n");   printf(" 20 = dac set loop intg on\n");   printf(" 27 = toggle s1-s4,itr, and intg_rd every 2 sec\n");   printf(" 32 = toggle everything every second\n");   fscanf(stdin,"%d",&mode);   if(mode == 20)    {loop20:       send13_3in1(2,0xe);       send4_3in1(0,0);     /* set intg_rd=0 */       send4_3in1(1,0);     /* set itr=0 */       for(i=0;i<0x400;i++)         {send13_3in1(6,i);  /* set dac value */          tsleep(0x80000005);         }         tsleep(0x80000010);       if(cadr != 0xfff) goto loop20;    }   if(mode == 27)    {  printf(" toggling integrator switches 2 sec\n");       send4_3in1(4,1);      /* enable small C */       send4_3in1(5,1);      /* enable large C */loop27:       send13_3in1(0,0);       send13_3in1(1,0);       send13_3in1(2,0);       tp_low();       sleep(2);       send13_3in1(0,1);       send13_3in1(1,1);       send13_3in1(2,0xf);       tp_high();       sleep(2);       if(cadr != 0xfff) goto loop27;    }   if(mode == 32)    {  printf(" toggling everything every sec\n");loop32:       l = (zone<<12) | (sector<<6) | card;       cadr = (unsigned short)l;       card_sel(cadr);       send4_3in1(4,1);      /* enable small C */       send4_3in1(5,1);      /* enable large C */       send13_3in1(0,0);     /* set intg_rd=0 */           send13_3in1(1,0);     /* set itr=0 */       send13_3in1(2,0);     /* s1=s2=s3=s4=0 */       tp_low();       rxw_low();       ena_low();       multi_low();       send13_3in1(6,0);      /* set dac=0 */       back_low();/*       clk_low();  */       sleep(1);       send13_3in1(0,1);     /* set intg_rd=1 */       send13_3in1(1,1);     /* set itr=1 */       send13_3in1(2,0xf);   /* s1=s2=s3=s4=1 */       tp_high();       rxw_high();       ena_high();       multi_high();       send13_3in1(6,0x3ff);      /* set dac=0x3ff *//*       clk_high();  */               send4_3in1(4,0);      /* disable small C */       send4_3in1(5,0);      /* disable large C */       back_high();       l = (zone<<12) | (sector<<6) | 0;       cadr = (unsigned short)l;       card_sel(cadr);       sleep(1);       if(cadr != 0xfff) goto loop32;    }}sw(i)   /* new switch timer module */int i;{ int k,l,shift;  unsigned short *adr;  adr = (unsigned short *)( 0xf0aa000c);  k = *adr;  shift = i-1;  l = (k>>shift) & 1;  return(l);}    go_get(v)      double *v;      {double volts;       if(ent == 0)         {gpib_reset();          sendmessage(gpib_adr,"A2 X");          sendmessage(gpib_adr,"A?");          getmessage(gpib_adr, &string[0] );/*          printf("A2 back=%s\n",string); */          sendmessage(gpib_adr,"C X");          sendmessage(gpib_adr,"C?");          getmessage(gpib_adr, &string[0] );/*          printf("C back=%s\n",string); */            sendmessage(gpib_adr,"R3 X");          sendmessage(gpib_adr,"R?");          getmessage(gpib_adr, &string[0] );/*          printf("R1,3 back=%s\n",string); */          sendmessage(gpib_adr,"N1 X");          sendmessage(gpib_adr,"N?");          getmessage(gpib_adr, &string[0] );/*          printf("N1 back=%s\n",string); */          sendmessage(gpib_adr,"G0 X");          sendmessage(gpib_adr,"G?");          getmessage(gpib_adr, &string[0] );/*          printf("G0 back=%s\n",string); */            sendmessage(gpib_adr,"Q0 X");          sendmessage(gpib_adr,"Q?");          getmessage(gpib_adr, &string[0] );/*          printf("Q0 back=%s\n",string); */          ent=1;         }          sendmessage(gpib_adr,"T6 X");          sendmessage(gpib_adr,"T?");          getmessage(gpib_adr, &string[0] );/*          printf("T6 back=%s\n",string); */          sleep(1);          getmessage(gpib_adr, &string[0] );/*          printf("first readback=%s\n",string); */          sscanf(string,"%le",&volts);/*          printf("volts=%e\n",volts);  */          *v=volts;          return(0);}